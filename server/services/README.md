# redis 设计

## 环境

- `redis 7.4.2`
- `ioredis 5.5.0`（此为`nodejs`包）

本模块未对`redis`老版本进行兼容，出现的一切由于`redis`版本兼容导致的问题本人概不负责

关于

## 业务逻辑

> [!NOTE]
>
> 请前端在设计帖子详情页的时候**务必**优先使用**获取帖子详情**专用 API，而非直接使用查询结果

### 缓存条目

- post
  - 单个帖子的详细内容
  - 未设置额外条件的分页查询结果

> [!NOTE]
>
> 鉴于本项目`posts`的设计逻辑较为混乱，且未使用`ORM`进行对象管理，暂时设计如上简单缓存条目

- campus
  - 待设计

### 缓存设立

- post
  - 获取帖子详情`(GET /byID/:post_id)`
  - 查询帖子（按条件）`(GET /search)` 

### 更新逻辑

- post
  - 在新帖发布`(POST /publish)`时新增缓存，并清除分页查询缓存
  - 在已有帖子被修改或删除时更新对应帖子缓存，并清除分页查询缓存
    - 删除帖子（软）`(DELETE /:post_id)`
    - 修改帖子`(PUT /:post_id)`
    - 修改点赞数`(PUT /like/:post_id)`
    - 修改投诉数`(PUT /complaint/:post_id)`