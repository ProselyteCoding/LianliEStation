# dashboard 监测数据

此文档记录了后台监测数据，需前后端配合实现。最终的呈现形式为前端在一特定页面路由下从数据库（或缓存？）中获取数据并显示。监测数据的过程实现由后端确定可行性（以下方案可行的把后面的`?`去掉，需要修改的直接在后面补充），可选择前端请求、或者后端记录以及其他专有库或服务器数据显示等方式，每种数据的监测方式明确后在文档上修改明确。

_日/周/月为一般量度，下文中用前缀`t`表示_

~~1. `t`网站访问次数/人数~~

        实现：访问时记录

~~2. 用户人数、活跃用户数（活跃用户可以通过一周内登录超过四次或者发帖大于三次来定义）~~

        实现：访问时记录

3.  `t`(商品浏览次数)、~~完成交易次数~~

        实现：随前端请求一并发送(?)

~~4. `t`发布商品分类、收藏商品分类、发帖次数~~

        实现：随前端请求一并发送(?)

5.  `t`搜索高频词（能否数据库把所有词记录下来，前端通过外部库分析出词云图之类的图表）

        实现思路：
        新建数据库search_keywords，sql见server/readme
        根据查询路径中的keywords关键字记录搜索词
        请求路径是/api/admin/search-keywords，详见api文档
        前端请求到相应数据可以做出相应处理

        问题：怎么解决污染？？？
        （暂时不考虑实现，等健全搜索词算法再考虑）

~~6. `t`违规人数、违规操作次数~~

        实现：数据库查表

7.  (每天使用的高峰时段)

        实现：访问记录时间戳查表

~~8. `t`广告的点击次数~~

        实现：访问记录

~~9. `t`会员开通情况~~

        实现：查表

API 设计改进：

- 删去 `/api/admin/ai/stats`，不再统计这一项
- 将已有的 `/api/admin/event-stats`更名为`/api/admin/stats`，返回所有需要的监测数据（在原基础上加几项）
- 关键词搜索统计`/api/admin/search-keyword`，目前没有进行相关的算法实现，保留，暂不考虑实现
- `/api/advertisements/stats`是不是与`/api/advertisements/list`有点重复？只保留信息全面的`/api/advertisements/list`呢？

```json
// /api/admin/stats ()
{
  "message": "事件统计数据获取成功",
  "data": {
    "visit": 1000,
    "users": 300,
    "posts": 150,
    "goods": 200,
    "banned_users": 5,
    "violation": 30, // 违规次数（response表中response_type为"violation"的）
    "publish_goods_tag": { 
      [
        "electronics": 45, // 数码电子
        "study": 20, // 学习资料
        "necessities": 15, // 生活用品
        "agency": 5, // 代办跑腿
        "consult": 10, // 咨询答疑
        "account": 3, // 账号会员
        "others": 8 // 其他
      ]
    },
    "publish_post_tag": {
      [
        "news": 45, // 新闻通知
        "confide": 15, // 吐槽倾诉
        "study": 20, // 学习资料
        "consult": 10, // 咨询答疑
        "team": 3, // 交友组队
        "others": 8 // 其他
      ]
    },
    "favorite_goods_tag": {
      [
        "electronics": 45, // 数码电子
        "study": 20, // 学习资料
        "necessities": 15, // 生活用品
        "agency": 5, // 代办跑腿
        "consult": 10, // 咨询答疑
        "account": 3, // 账号会员
        "others": 8 // 其他
      ]
    },
    "favorite_post_tag": {
      [
        "news": 45, // 新闻通知
        "confide": 15, // 吐槽倾诉
        "study": 20, // 学习资料
        "consult": 10, // 咨询答疑
        "team": 3, // 交友组队
        "others": 8 // 其他
      ]
    },
    "completed_transaction": 120,
    "membership": 5,
    "ad_click": 10,
    "ad_add": 3,

    // -----------------------------------
    // 以上为总数统计，以下为近一周数据统计

    "recent_7_days": {
        "visit": 100,
        "active_users": 50,  // 活跃用户数（基于 info 字段去重统计不同用户，7 天中访问次数多于 7 次的用户）,
        "completed_transaction": 20,
        "membership": 2,
        "ad_click": 5,
        "ad_add": 1,
        "register": 3, // 查找users表中最近7天注册的用户数
        "goods": 10, // 查找goods表中最近7天发布的商品数
        "posts": 15, // 查找posts表中最近7天发布的帖子


        "publish_goods_tag": {  // 每周的发布商品标签统计
          "electronics": 45, // 数码电子
          "study": 20, // 学习资料
          "necessities": 15, // 生活用品
          "agency": 5, // 代办跑腿
          "consult": 10, // 咨询答疑
          "account": 3, // 账号会员
          "others": 8 // 其他
        },
        "favorite_goods_tag": {  // 每周的收藏商品标签统计
          "electronics": 45, // 数码电子
          "study": 20, // 学习资料
          "necessities": 15, // 生活用品
          "agency": 5, // 代办跑腿
          "consult": 10, // 咨询答疑
          "account": 3, // 账号会员
          "others": 8 // 其他
        },
        "publish_post_tag": {  // 每周的发布帖子标签统计
          "news": 45, // 新闻通知
          "confide": 15, // 吐槽倾诉
          "study": 20, // 学习资料
          "consult": 10, // 咨询答疑
          "team": 3, // 交友组队
          "others": 8 // 其他
        },
        "favorite_post_tag": {  // 每周的收藏帖子标签统计
          "news": 45, // 新闻通知
          "confide": 15, // 吐槽倾诉
          "study": 20, // 学习资料
          "consult": 10, // 咨询答疑
          "team": 3, // 交友组队
          "others": 8 // 其他
        },
        "daily_records": [ // 每周中每天的统计数据（用于绘制折线图），含7个对象的对象数组
          {
            "date": "2025-09-01",
            "visit": 45,
            "ad_click": 23,
            "completed_transaction": 12,
            "register": 20,
            "goods": 15,
            "posts": 18,
            "membership": 1
          },
          {}
        ]
    }
  }
}
```

数据说明

- `users`: 用户总数
- `posts`: 帖子总数
- `goods`: 商品总数
- `violation` 违规次数（response表中response_type为"violation"的）
- `banned_users`: 被封禁用户数
- `active_users`: 活跃用户数（基于 info 字段去重统计不同用户，7 天中访问次数多于 7 次的用户）
- `visit`: ~~活跃用户数（基于 info 字段去重统计不同用户）~~访问次数，统计同一用户多次访问
- `publish_goods_tag`: ~~商品发布总次数~~不是计总数，是统计各 tag 的次数，对象
- `publish_post_tag`: ~~帖子发布总次数~~不是计总数，是统计各 tag 的次数，对象
- `favorite_goods_tag`: ~~商品收藏总次数~~不是计总数，是统计各 tag 的次数，对象
- `favorite_post_tag`: ~~帖子收藏总次数~~不是计总数，是统计各 tag 的次数，对象
- `completed_transaction`: 完成交易总次数
- `membership`: 会员开通总次数
- `ad_click`: 广告点击总次数
- `ad_add`: 广告添加总次数
- `recent_7_days`: 最近 7 天统计数量（用于绘制折线图、趋势图）
