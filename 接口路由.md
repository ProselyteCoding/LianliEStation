# 接口文档

此文档参考后端现有 api 文档，以模块为单位从前端角度描述了所需请求接口，对比已有路由需要进行的更改不多（主要是进行了划分和路由调整），更多是作为一个便于查表的资料，供后端参考重构。

如路由设计不合理或者接口功能有问题，请及时联系讨论，接口实现方式请后端自行选择。

---

## **一、用户模块**

此模块包含用户的登录注册及设置接口。

将登录注册及密码修改接口使用 `auth` 命名空间，将用户信息获取与修改接口使用 `users` 命名空间。

| 功能                 | 方法 | 路径                             | 说明                                                                                                       |
| -------------------- | ---- | -------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| 用户注册             | POST | `/api/auth/register`             | 原路由`/api/users/register`，无需修改内容(==已完成==)                                                      |
| 用户登录             | POST | `/api/auth/login`                | 原路由`/login`，无需修改内容(==已完成==)                                                                   |
| 获取当前用户信息     | GET  | `/api/users/profile`             | 建议整合目前获取信息与获取主题接口，在这个统一接口中返回，前端拆解。原路由`/api/users/profile`(==已完成==) |
| 修改用户信息         | PUT  | `/api/users/profile`             | 修改昵称等设置中的全部文字信息（包括主题号），原路由`/api/users/profile`，修改较多(==已完成==)             |
| 请求验证码           | POST | `/api/auth/verification`         | 发送验证码（用于重置密码），原路由`/api/users/RequestVerification`，无需修改内容(==已完成==)               |
| 修改密码             | PUT  | `/api/auth/change-password`      | 修改密码（由于需要验证，单独开一个接口），原路由`/api/users/change-password`，无需修改内容(==已完成==)     |
| 修改用户图片         | PUT  | `/api/users/profile/image`       | 统一上传头像/背景/Banner（`type=avatar/background/banner`），合并了三个分开的接口(==已完成==)              |
| 根据 ID 获取用户信息 | GET  | `/api/users/user-info/{user_id}` | 用于商品详情页和帖子页显示发布者信息，原路由`/api/users/userInfo/:user_id`，无需修改内容(==已完成==)       |

---

## **二、商品模块**

指商城页、详情页及更改相关的商品接口。有较多路由名的更正，使用 `goods`。

_请明确概念：商品(goods)是二手交易模块相关的，而帖子(posts)是校园墙模块的，建议更改当前路由命名，以实现清晰区分。此后将严格区分二者命名以便合作。_
_数据库的建表命名也应做对应修改。_

| 功能          | 方法   | 路径                                            | 说明                                                                                                                                       |
| ------------- | ------ | ----------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| 分页查询商品  | GET    | `/api/goods?campus=1&type=sell&page=1&limit=10` | 支持标题、类型、校区等多条件筛选，将原有获取所有帖子的接口并入此接口，筛选条件可以默认设置为“全部”，原路由`/api/posts/search` (==已完成==) |
| 修改商品      | PUT    | `/api/goods/{post_id}`                          | 仅作者或管理员可操作，原路由`/api/posts/:post_id` (==已完成==)                                                                             |
| 软删除商品    | DELETE | `/api/goods/{post_id}`                          | 标记为 `deleted`，原路由`/api/posts/:post_id`，无需修改内容 (==已完成==)                                                                   |
| 点赞/取消点赞 | POST   | `/api/goods/{post_id}`                          | `/api/like/:post_id`，使用 Redis 计数，异步持久化到数据库 (==已完成==)                                                                     |
| 投诉/取消投诉 | POST   | `/api/goods/{post_id}`                          | `/api/complaint/:post_id`，同上（请求头或者参数部分加以区分） (==已完成==)                                                                 |

---

## **三、历史模块**

新增校园墙历史接口，前端选择商品或者帖子历史进行切换。

| 功能             | 方法   | 路径                           | 说明                                                                                                                                    |
| ---------------- | ------ | ------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------- |
| 查询发布商品历史 | GET    | `/api/history/goods`           | 此接口为原`/api/posts/user-history`，同时需进行修改，返回一个对象包含两个数组，一个是用户发布的商品历史、一个是发布的帖子历史，前端解构 |
| 修改交易状态     | 待实现 | `/api/history/goods/{post_id}` | 修改商品的状态 `active/inactive/deleted` (是否把数据库中 `inactive` 状态改成 `fulfilled` 表示完成呢？)                                  |
| 删除帖子         | DELETE | `/api/history/posts/{post_id}` | 软删除帖子，管理员可硬删，无需修改内容除                                                                                                |

---

## **四、收藏模块**

新增校园墙收藏接口，前端选择商品或者帖子收藏进行切换。

| 功能         | 方法   | 路径                          | 说明                                                                                                                          |
| ------------ | ------ | ----------------------------- | ----------------------------------------------------------------------------------------------------------------------------- |
| 商品添加收藏 | POST   | `/api/favorites/goods/add`    | 无需修改内容,`/api/favorites/add`                                                                                             |
| 商品移除收藏 | DELETE | `/api/favorites/goods/remove` | 无需修改内容,`/api/favorites/remove`                                                                                          |
| 帖子添加收藏 | POST   | `/api/favorites/posts/add`    | 无需修改内容                                                                                                                  |
| 帖子移除收藏 | DELETE | `/api/favorites/posts/remove` | 无需修改内容                                                                                                                  |
| 查询收藏     | GET    | `/api/favorites/`             | 新增接口，返回一个对象包含两个数组，一个是用户发布的商品历史、一个是发布的帖子历史，前端解构。`/api/favorites/user/favorites` |

---

## **五、申诉模块**

此部分只有从用户角度提交申诉的接口，用户查看申诉在信箱模块、管理员处理申诉在管理员模块。

| 功能     | 方法 | 路径                   | 说明 |
| -------- | ---- | ---------------------- | ---- |
| 提交申诉 | POST | `/api/appeals/publish` |      |

---

## **六、校园墙模块**

| 功能         | 方法   | 路径                                        | 说明                         |
| ------------ | ------ | ------------------------------------------- | ---------------------------- |
| 条件查询帖子 | GET    | `/api/forum/posts?campus=1&page=1&limit=10` |                              |
| 删除帖子     | DELETE | `/api/forum/posts/delete`                   | 用户可软删除，管理员可硬删除 |
| 帖子互动     | POST   | `/api/forum/posts/interact`                 | 点赞、评论                   |

---

## **七、信箱模块**

目前 appeals 和 responses 都在这一模块，但是 appeals 没有 read 的已读状态，建议后端思考后尽量将这两个表的属性对齐一些，添加这个已读/未读的状态筛选。

合并查询申诉接口（添加一个`all`状态）、软删除申诉接口与更新申诉状态接口合并。

| 功能         | 方法 | 路径                   | 说明                                                                                 |
| ------------ | ---- | ---------------------- | ------------------------------------------------------------------------------------ |
| 获取通知     | GET  | `/api/messages/???`    | 这块需要根据修改后这两个表的结构而调整，是既同时获取申诉和回复的通知，还是分开获取？ |
| 修改通知状态 | PUT  | `/api/messages/status` | 修改已读/未读                                                                        |
| 查询申诉     | GET  | `/api/appeals/search`  | 传参 status: `pending`、`resolved`、`deleted`(加一个`all`的筛选方式?)                |

---

## **八、发布模块**

| 功能             | 方法 | 路径                    | 说明                       |
| ---------------- | ---- | ----------------------- | -------------------------- |
| 发布商品         | POST | `/api/publish/goods`    | 原路由`/api/posts/publish` |
| 发布帖子         | POST | `/api/publish/posts`    |                            |
| 生成 AI 模板信息 | POST | `/api/publish/template` | prompt 后续还需要优化      |

## **九、管理员模块**

建议使用 `admin` 命名空间，将原有 `/api/users` 中的用户管理接口合并到此模块。此模块有较多需要更新添加的接口，建议先完成其他内容修改，最后再开发这块。

| 功能                   | 方法   | 路径                        | 说明                                                         |
| ---------------------- | ------ | --------------------------- | ------------------------------------------------------------ |
| 管理员搜索用户         | GET    | `/api/admin/search-user`    | 通过 QQ 搜索用户，原路由`/api/users/searchByQQ`              |
| 管理员获取用户发布历史 | GET    | `/api/admin/search-history` | 用于管理员查看用户发布历史是否违规                           |
| 管理员删除商品         | DELETE | `/api/admin/goods/delete`   | 新增接口                                                     |
| 管理员删除帖子         | DELETE | `/api/admin/posts/delete`   | 新增接口                                                     |
| 修改用户信用分         | PUT    | `/api/admin/credit`         | 原路由`/api/users/updateCredit`                              |
| 获取申诉列表           | GET    | `/api/admin/appeals`        | 用于管理员进行申诉处理，`/api/appeals/`                      |
| 更新申诉状态           | PUT    | `/api/admin/appeals`        | 原路由`/api/appeals/:appeal_id`                              |
| 封禁用户               | PUT    | `/api/admin/ban`            | 传参封禁时长                                                 |
| 解封用户               | PUT    | `/api/admin/unban`          |                                                              |
| 获取监测信息           | GET    | `/api/admin/monitor`        | 新增接口，用于管理员查看系统运行状态，返回值参考监测数据文档 |

---
