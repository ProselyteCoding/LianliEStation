# 9.20 讨论内容

## 后端

- ~~修改数据库表~~
  - ~~添加“高级权限”表，目前表中只有置顶次数，后期可扩展~~
  - ~~修改posts表，添加标签字段~~
  - ~~advertisements表不应修改（点击后进入广告详情页，允许广告商输入广告词等内容）~~
  - ~~增加若干数据记录表，记录数据次数（与下文‘在需要记录次数的API添加记录’配合）~~
  - ~~将users表中的user_type字段改为is_admin字段，boolean类型~~
- ~~增加AI+敏感词库的审核并提供接口~~
- 在需要记录次数的API添加记录
- ~~增加广告相关api~~
  - ~~增加广告~~
  - ~~删除广告~~
  - ~~修改广告~~
  - ~~点击广告(修改数据记录表)~~
- 过期清理，对于过期的会员、~~广告等进行清理~~
- ~~更新文档、删除多余的删除api、有一处goods相关接口使用post错误~~
- ~~“软删除商品”接口加一个参数，区分是完成交易还是删除，交易成功则记录在数据记录表中~~

### 数据库新增表

```sql
-- 用户高级权限表
CREATE TABLE `user_privileges` (
    `id` INT AUTO_INCREMENT PRIMARY KEY,
    `user_id` INT NOT NULL,
    `top_post_count` INT DEFAULT 0, -- 剩余置顶帖子次数
    `top_goods_count` INT DEFAULT 0, -- 剩余置顶商品次数
    FOREIGN KEY (`user_id`) REFERENCES `users`(`id`) ON DELETE CASCADE
);

-- 下面两张表格已实现，合并为`record_event`表，以`readme`中描述为准

-- -- 触发记录事件(数据记录表)
-- CREATE TABLE `record_event` (
--     `id` INT AUTO_INCREMENT PRIMARY KEY,
--     `info` VARCHAR(255), -- 额外记录信息，可为空，不同类型的记录灵活添加，如访问的记录可添加用户的id以记录活跃用户
--     `type` VARCHAR(50) NOT NULL, -- 记录类型：'visit'访问, 'publish_goods_tag'发布商品时记录标签, 'publish_post_tag'发布帖子时记录标签, 'favorite_goods_tag'收藏商品时记录标签, 'favorite_post_tag'收藏帖子时记录标签, 'completed_transaction'完成交易, 'membership'会员开通（留下记录，防止过期后无记录）, 'ad_click'广告点击（留下记录，防止过期后无记录）, 'ad_add'广告添加（留下记录，防止过期后无记录）
--     `recorded_at` DATETIME DEFAULT CURRENT_TIMESTAMP
-- );

-- -- 不同类型的记录次数(数据记录表)
-- CREATE TABLE `data_counts` (
--     `id` INT AUTO_INCREMENT PRIMARY KEY,
--     `type` VARCHAR(255) NOT NULL, -- 记录类型：'visit'访问, 'publish_goods_tag'发布商品时记录标签, 'publish_post_tag'发布帖子时记录标签, 'favorite_goods_tag'收藏商品时记录标签, 'favorite_post_tag'收藏帖子时记录标签, 'completed_transaction'完成交易, 'membership'会员开通（留下记录，防止过期后无记录）, 'ad_click'广告点击（留下记录，防止过期后无记录）, 'ad_add'广告添加（留下记录，防止过期后无记录）
--     `count` INT DEFAULT 0
-- );
```

### 触发记录的 API

- ~~/api/users/profile(GET) 初始化用户信息API，新增记录访问次数，记录类型为`visit`~~   记录用户id
- ~~/api/publish/goods(POST) 发布商品API，新增记录发布商品时的标签，记录类型为`publish_goods_tag`~~   记录商品id
- ~~/api/favorites/goods/add(POST) 收藏商品API，新增记录收藏商品时的标签，记录类型为`favorite_goods_tag`~~  记录商品id
- ~~/api/publish/posts(POST) 发布帖子API，新增记录发布帖子时的标签，记录类型为`publish_post_tag`~~  记录帖子id
- ~~/api/favorites/posts/add(POST) 收藏帖子API，新增记录收藏帖子时的标签，记录类型为`favorite_post_tag`~~  记录帖子id
- ~~/api/goods/:post_id(DELETE) 软删除商品API，加一个参数，区分是完成交易还是删除，新增记录完成交易的次数，记录类型为`completed_transaction`~~   记录商品id
- /api/membership/purchase(POST)(新增API) 购买会员API，新增记录会员开通，记录类型为`membership`
- ~~/api/advertisements/click(POST)(新增API) 广告点击API，新增记录广告点击，记录类型为`ad_click`~~
- ~~/api/advertisements/add(POST)(新增API) 广告添加API，新增记录广告添加，记录类型为`ad_add`~~

## 前端

- 根据“筛选分类”文档的标签对于现有标签进行修改（包括显示和发布）（商城已完成）
- “历史”部分，增加完成交易与删除的区分
- 管理页
- 完善样式
- ~~增加完整的loading效果~~
- ~~路由系统完善，游客访问权限~~

## 其他

- ~~将数据库名从`marketplace`改为`lianli`~~
